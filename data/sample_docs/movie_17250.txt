Captain Underpants: The First Epic Movie

In the city of Piqua, Ohio, two fourth-grade friends and next-door neighbors named George Beard (Kevin Hart) and Harold Hutchins (Thomas Middleditch) are the pranksters at their school, Jerome Horwitz Elementary School. They excessively pull numerous pranks on the cruel teachers, many of which are directed at their "evil" principal, Mr. Benjamin "Benny" Krupp (Ed Helms), putting the two at odds with him. The duo also create comic books about a superhero named Captain Underpants, a character who has superpowers and wears underwear and a cape. They sell these to their schoolmates through a comic company called Treehouse Comix Inc., located in their treehouse. George and Harold's pranks come to an apparent end after they're caught tampering with a toilet invention, the Turbo Toilet 2000, made by the school's local snitch and intellectual, Melvin Sneedly (Jordan Peele), on video. Finally having solid proof of the boys' antics, Mr. Krupp excitedly prepares to annihilate their friendship by putting them in separate classes.
To prevent this, George hypnotizes Mr. Krupp with a 3D Hypno Ring he received out of a cereal box. The boys see that Mr. Krupp bears an odd resemblance to Captain Underpants without his toupee and command him to be Captain Underpants. The boys soon learn the severity of their actions when "Captain Underpants" begins causing problems around Piqua. To prevent these issues, the boys take him to their treehouse, where they discover that they can turn Captain Underpants back into Mr. Krupp by splashing water on him and can turn him back into Captain Underpants by snapping their fingers. Knowing that Mr. Krupp will continue trying to separate them, they decide to settle with Captain Underpants but insist that he be dressed up as Mr. Krupp under the pretense of a "secret identity," to which Captain Underpants agrees. His sudden personality change even manages to attract the attention (and affection) of the school's shy lunch lady, Edith (Kristen Schaal).
Just when George and Harold believe that their troubles have ended, Jerome Horwitz Elementary School is visited by an odd, German-accented scientist named Professor Pee-Pee Diarrheastein Poopypants, Esq. (Nick Kroll), or as he calls himself, Professor P. Captain Underpants (disguised as Mr. Krupp) hires him to be the new science teacher, but George and Harold are suspicious of him due to his violent and short-tempered attitude, as well as his resume's content. As it turns out, Poopypants is seeking to get rid of laughter altogether due to the fact that people have made fun of his name for years. He recruits Melvin to help him, as he discovers (after reading a comic book George and Harold made featuring characters resembling them) that Melvin's brain makes him incapable of laughing or having fun.
After a school carnival accident caused by Captain Underpants, Mr. Krupp finally separates the boys. Professor Poopypants tries to take over the town with a giant version of the Turbo Toilet 2000, fueled by the school cafeteria's rotten leftovers left out by Edith and uses Melvin's brain to turn the children into glum, humorless zombies. Captain Underpants tries to stop the villain, but due to having no actual superpowers, is effortlessly defeated and thrown into the toilet. George and Harold are captured and nearly turned into zombies, but are able to escape after Professor Poopypants mentions the planet Uranus, causing the boys to laugh and damage the Turbo Toilet 2000's computer, restoring the children back to normal. Upon consuming the mutated leftovers, Captain Underpants acquires superpowers and, with George and Harold's help, defeats and shrinks Poopypants, though he escapes on a bumblebee shortly thereafter.
Knowing that they can't control Captain Underpants, George and Harold destroy the Hypno Ring to permanently change him back into Mr. Krupp. Feeling that Mr. Krupp would be nicer if he had friends, the boys set him and lovesick Edith up on a date, thus making Mr. Krupp have a change of heart. Krupp returns the comics he took away from George and Harold, and even admits their comics are funny. However, the toxic waste from the Turbo Toilet 2000 transforms all the toilets into vicious monsters which attack the restaurant at which Mr. Krupp and Edith are dining. Upon snapping his fingers, Mr. Krupp once again becomes Captain Underpants, carrying George and Harold away to help him fight them, much to Edith's surprise and admiration.
In a mid-credits scene, George and Harold realize that the secretary, who they put on hold before by faking a contest with a cash prize of $1 billion, has been on the phone for the entire film, so they shut off the call, make the secretary angry, and make a new comic based on her reaction.